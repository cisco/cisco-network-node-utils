# fabricpath
---
# Fabricpath feature is not available on N3K and N9K
_exclude: [/N3/, /N9K/]

aggregate_multicast_routes:
  _exclude:
    - /N5K/
  kind: boolean
  get_command: "show run fabricpath"
  get_value: '/^fabricpath multicast aggregate\-routes\s*$/'
  set_value: "<state> fabricpath multicast aggregate-routes"
  default_value: false
  
allocate_delay:
  kind: int
  get_command: "show fabricpath timers"
  get_value: '/^Allocate Delay Timer\s+:\s+(\d+)/'
  set_value: "<state> fabricpath timers allocate-delay <delay>"
  default_value: 10

auto_switch_id: 
  kind: int
  get_command: "show fabricpath switch-id"
  get_value: '/^\*\s+(\d+).*No\s*$/'

feature:
  get_command: "show feature-set"
  get_value: '/^fabricpath[\s]+[\d]+[\s]+(\S+)/'
  set_value: "<state> feature-set fabricpath"

feature_install:
  set_value: "<state> install feature-set fabricpath"

graceful_merge:
  auto_default: false
  kind: boolean
  get_command: "show run fabricpath"
  get_value: '/^fabricpath graceful\-merge disable\s*$/'
  set_value: "<state> fabricpath graceful-merge disable"
  default_value: true

linkup_delay:
  kind: int
  get_command: "show fabricpath timers"
  get_value: '/^Link\-up Delay Timer\s+:\s+(\d+)/'
  set_value: "<state> fabricpath timers linkup-delay <delay>"
  default_value: 10

linkup_delay_always:
  _exclude:
    - /N5K/
  kind: boolean
  get_command: "show fabricpath timers"
  get_value: '/^Link\-up Delay Timer\s+:\s+\d+\s+\(always\)$/'
  set_value: "<state> fabricpath timers linkup-delay always"
  default_value: false
  
linkup_delay_enable:
  _exclude:
    - /N5K/
  auto_default: false
  kind: boolean
  get_command: "show fabricpath timers"
  get_value: '/^Link\-up Delay\s+:\s+Enabled$/'
  set_value: "<state> fabricpath linkup-delay"
  default_value: true
  
loadbalance_algorithm:
  kind: string
  get_command: "show fabricpath load-balance | begin ECMP next 4"
  get_value: '/^Hash Control: (\S+)/'
  set_value: "<state> fabricpath load-balance <algo>"
  '/N5K/':
    default_value: "source-destination"
  else:
    default_value: "symmetric"

loadbalance_multicast_has_vlan:
  _exclude:
    - /N5K/
  kind: boolean
  get_command: "show fabricpath load-balance | begin Ftag"
  get_value: '/^Use VLAN: TRUE$/'
  default_value: false

loadbalance_multicast_reset:
  _exclude:
    - /N5K/
  set_value: "no fabricpath load-balance multicast"

loadbalance_multicast_rotate:
  _exclude:
    - /N5K/
  kind: int
  get_command: "show fabricpath load-balance | begin Ftag"
  get_value: '/^Rotate amount: (\d+)/'
  default_value: 1
 
loadbalance_multicast_set:
  _exclude:
    - /N5K/
  set_value: 'fabricpath load-balance multicast <rotate_amt> <inc_vlan>'

loadbalance_unicast_has_vlan:
  kind: boolean
  get_command: "show fabricpath load-balance | begin ECMP next 4"
  get_value: '/^Use VLAN: TRUE$/'
  set_value: "<state> fabricpath load-balance unicast include-vlan"
  default_value: false

loadbalance_unicast_layer:
  kind: string
  get_command: "show fabricpath load-balance | begin ECMP next 4"
  get_value: '/^L3\/L4 Preference: (\S+)/'
  set_value: "<state> fabricpath load-balance unicast <pref>"
  default_value: "mixed"

loadbalance_unicast_reset:
  set_value: "no fabricpath load-balance unicast"

loadbalance_unicast_rotate:
  _exclude:
    - /N5K/
  kind: int
  get_command: "show fabricpath load-balance | begin ECMP next 4"
  get_value: '/^Rotate amount: (\d+)/'
  default_value: 1

loadbalance_unicast_set:
  set_value: 'fabricpath load-balance unicast <pref> <rotate_amt> <inc_vlan>'

loadbalance_unicast_support:
  kind: string
  '/N5K/':
    default_only: "split"
  else:
    default_only: "combined"


mode:
  kind: string
  get_command: "show run fabricpath"
  get_value: '/^fabricpath mode (\S+)/'
  set_value: "<state> fabricpath mode transit"
  default_value: "normal"

switch_id:
  kind: int
  get_command: "show run fabricpath"
  get_value: '/^fabricpath switch-id (\d+)/'
  set_value: "fabricpath switch-id <swid>"

transition_delay:
  kind: int
  get_command: "show fabricpath timers"
  get_value: '/^Transition Delay Timer\s+:\s+(\d+)/'
  set_value: "<state> fabricpath timers transition-delay <delay>"
  default_value: 10

ttl_multicast:
  _exclude:
    - /N5K/
  kind: int
  get_command: "show fabricpath ttl"
  get_value: '/^Multicast TTL:\s+(\d+) hops/'
  set_value: "<state> fabricpath ttl multicast <ttl>"
  default_value: 32

ttl_unicast:
  _exclude:
    - /N5K/
  kind: int
  get_command: "show fabricpath ttl"
  get_value: '/^Unicast TTL:\s+(\d+) hops/'
  set_value: "<state> fabricpath ttl unicast <ttl>"
  default_value: 32

